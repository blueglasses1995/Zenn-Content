---
title: ""
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

```sh
npm i -g @nestjs/cli
nest new nest-apollo
code nest-apollo
```

```sh
npm i @nestjs/graphql @nestjs/apollo @apollo/server graphql
```

```ts:app.module.ts
import { Module } from '@nestjs/common';
import { GraphQLModule } from '@nestjs/graphql';
import { ApolloDriver, ApolloDriverConfig } from '@nestjs/apollo';

@Module({
  imports: [
    GraphQLModule.forRoot<ApolloDriverConfig>({
      driver: ApolloDriver,
    }),
  ],
})
export class AppModule {}
```

ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã€`Query root type must be provided`ã¨ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚
```sh
npm run start:dev
```

ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§é–‹ç™ºã™ã‚‹ã“ã¨ã¨ã—ã€GraphQL SDLã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚
ã¾ã ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãªã„ãŸã‚ã€`No type definitions were found with the specified file name patterns`ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚

```ts:app.module.ts
imports: [
    GraphQLModule.forRoot<ApolloDriverConfig>({
      driver: ApolloDriver,
      typePaths: ['./**/*.graphql'],
    }),
  ],
```

é–‹ç™ºæ™‚ã«ã¯ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã«å¯¾å¿œã™ã‚‹TypeScriptå‹ãŒæ¬²ã—ã„ã€‚
ä¸€èˆ¬ã«ã¯codegenã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚
`@nestjs/graphql`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ASTã‚’ç”¨ã„ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã™ã‚‹ãŸã³ã«ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‹ã‚‰TypeScriptå‹ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€‚
ç”Ÿæˆã•ã‚Œã‚‹TypeScriptå‹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã ãŒã€`outputAs`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚¯ãƒ©ã‚¹ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```ts:app.module.ts
  imports: [
    GraphQLModule.forRoot<ApolloDriverConfig>({
      driver: ApolloDriver,
      typePaths: ['./**/*.graphql'],
      definitions: {
        path: join(process.cwd(), 'src/graphql.ts'),
        outputAs: 'class',
      },
    }),
  ],
```

ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®å ´åˆã€TSã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼APIãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
```sh
npm i ts-morph
```

```ts:Author/author.graphql
type Author {
  id: ID!
  firstName: String!
  lastName: String!
}
```

```ts:query.graphql
type Query {
  Author(id: ID!): Author
}
```

ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ç›´ã™ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã‚‹ã€‚
http://localhost:3000/graphqlã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨graphql playgroundã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚
ã‚¯ã‚¨ãƒªã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—å®Ÿè¡Œã™ã‚‹ã¨jsonãŒå¾—ã‚‰ã‚Œã‚‹ã€‚

```gql
query fetch {
  Author(id: "1") {
    id
    firstName
  }
}
```

```json
{
  "data": {
    "Author": null
  }
}
```

ä¸€èˆ¬çš„ã«ã¯GraphQLã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®type Queryã«å¯¾å¿œã™ã‚‹ãƒªã‚¾ãƒ«ãƒãƒ¼ã®ãƒãƒƒãƒ—ã‚’æ‰‹å‹•ã§è¨­å®šã™ã‚‹ã€‚
ã—ã‹ã—ã€`@nestjs/graphql`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨ã„ã‚‹ã¨`Resolver`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè‡ªå‹•ã§ãƒªã‚¾ãƒ«ãƒãƒ¼ãƒãƒƒãƒ—ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã€‚

ã¾ãšãƒªã‚¾ãƒ«ãƒãƒ¼ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```sh
nest g r Author
```

ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ã€‚
`Query`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯`@nestjs/graphql`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

```ts:Author/author.resolver.ts
@Resolver()
export class AuthorResolver {
  @Query()
  Author(@Args('id') id: string): Author {
    return { id, firstName: 'John', lastName: 'Doe' };
  }
}
```

playgroundã§å†åº¦ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å€¤ãŒè¿”ã£ã¦ãã‚‹ã€‚

```json
{
  "data": {
    "Author": {
      "id": "1",
      "firstName": "John"
    }
  }
}
```

Authorãƒ¡ã‚½ãƒƒãƒ‰ã®Aã‚’å°æ–‡å­—ã«ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚

```ts:Author/author.resolver.ts
@Resolver()
export class AuthorResolver {
  @Query()
  author(@Args('id') id: string): Author {
```

ã‚¨ãƒ©ãƒ¼åŸå› ã¯ãƒªã‚¾ãƒ«ãƒãƒ¼ã«authorã‚¯ã‚¨ãƒªãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã«ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€‚
NestJSã®Controllerã®ãƒ¡ã‚½ãƒƒãƒ‰åã¯ä»»æ„ã®åç§°ã§è‰¯ã‹ã£ãŸã€‚
ã—ã‹ã—ã€Resolverã§ã¯ãƒ¡ã‚½ãƒƒãƒ‰åãŒã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®ã‚¯ã‚¨ãƒªåã¨å¯¾å¿œã—ã¦ã„ãªã„ã¨ã„ã‘ãªã„ã€‚

```sh
Error: Query.author defined in resolvers, but not in schema
```

Authorå‹ã«Postå‹ã®é…åˆ—ã‚’æŒãŸã›ã‚‹ã€‚

```gql:Author/author.graphql
type Author {
  id: ID!
  firstName: String!
  lastName: String!
  posts: [Post]
}

type Post {
  id: ID!
  title: String!
  content: String!
}
```

```gql
query fetch {
  Author(id: "1") {
    id
    firstName
    lastName
    posts {
      id
      title
      content
    }
  }
}
```

postsã«ã¯nullãŒè¿”ã£ã¦ãã‚‹ã€‚

```json
{
  "data": {
    "Author": {
      "id": "1",
      "firstName": "John",
      "lastName": "Doe",
      "posts": null
    }
  }
}
```

`ResolveField`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ç”¨ã„ã¦GraphQLå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆéã‚¹ã‚«ãƒ©ãƒ¼ï¼‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç™»éŒ²ã™ã‚‹ã€‚
æ³¨æ„ç‚¹ã¨ã—ã¦ã€`Resolver`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ã€Œã©ã®GraphQLå‹ã«å¯¾å¿œã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã®ã‹ã€ã‚’æ˜è¨˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```ts:author.resolver.ts
@Resolver('Author')
export class AuthorResolver {
  @Query()
  Author(@Args('id') id: string): Author {
    return { id, firstName: 'John', lastName: 'Doe' };
  }

  @ResolveField()
  posts() {
    return [
      {
        id: '1',
        title: 'Post 1',
        content: 'Content 1',
      },
    ];
  }
}
```

å†åº¦ã‚¯ã‚¨ãƒªã‚’é£›ã°ã™ã¨postsã®çµæœãŒè¿”ã£ã¦ãã‚‹ã€‚
`Resolver`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å¼•æ•°ã‚’æ¶ˆã™ã¨postsãŒnullã§è¿”ã£ã¦ãã‚‹ã€‚

```json
{
  "data": {
    "Author": {
      "id": "1",
      "firstName": "John",
      "lastName": "Doe",
      "posts": [
        {
          "id": "1",
          "title": "Post 1",
          "content": "Content 1"
        }
      ]
    }
  }
}
```

ãƒ¡ã‚½ãƒƒãƒ‰åã‚’å¤§æ–‡å­—ã«ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã‚‹ã€‚

```ts:Author/author.resolver.ts
  @ResolveField()
  Posts() {
    return [
      {
        id: '1',
        title: 'Post 1',
        content: 'Content 1',
      },
    ];
  }
```

ãƒªã‚¾ãƒ«ãƒãƒ¼ãŒAuthorå‹ã«Postsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹å‰æã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã‚‹ãŒã€ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®Authorå‹ã«ã¯Postsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ã€‚

```sh
Error: Author.Posts defined in resolvers, but not in schema
```

`Resolver`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å¼•æ•°ã«ã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„å‹åã‚’æ¸¡ã™ã€‚

```ts:Author/author.resolver.ts
@Resolver('author')
export class AuthorResolver {
```

ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã«å¯¾è±¡ã®å‹ãŒå­˜åœ¨ã—ãªã„ã¨ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚

```sh
Error: "author" defined in resolvers, but not in schema
```

Authorãƒ¡ã‚½ãƒƒãƒ‰å´ã§postsã‚’è¿”ã—ã¦ã‚ã’ã¦ã‚‚ã€postsãƒ¡ã‚½ãƒƒãƒ‰å´ã®å€¤ãŒè¿”ã£ã¦ãã‚‹ã€‚
ã¡ãªã¿ã«postsãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰`ResolveField`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’å¤–ã™ã¨Authorãƒ¡ã‚½ãƒƒãƒ‰å´ã®postsãŒè¿”ã£ã¦ãã‚‹ã€‚

```ts:Author/author.resolver.ts
@Query()
  Author(@Args('id') id: string): Author {
    return { id, firstName: 'John', lastName: 'Doe', posts: [] };
  }
```

`Query`, `ResolveField`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ãã‚Œãã‚Œã«ã‚¯ã‚¨ãƒªåã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’æ¸¡ã™ã“ã¨ã§ãƒ¡ã‚½ãƒƒãƒ‰åã‚’ä»»æ„ã«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```ts:Author/author.resolver.ts
@Query('Author')
  getAuthor(@Args('id') id: string): Author {
    return { id, firstName: 'John', lastName: 'Doe' };
  }

  @ResolveField('posts')
  getPosts() {
    return [
      {
        id: '1',
        title: 'Post 1',
        content: 'Content 1',
      },
    ];
  }
```

# parentå–ã‚Šå‡ºã™

è¦ªã‚¯ã‚¨ãƒªã‹ã‚‰ã®å€¤ã‚’å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã‚‹ã€‚

```ts:Author/author.resolver.ts
  @ResolveField()
  posts(@Parent() author: Author) {
    return [
      {
        id: '1',
        title: 'Post 1',
        content: `Content 1 from ${author.firstName} ${author.lastName}`,
      },
    ];
  }
```

# ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹
# ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
# ãƒ‘ã‚¤ãƒ—
# ä¾‹å¤–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
# ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
# ã‚¬ãƒ¼ãƒ‰
# Zodå°å…¥
# Prisma å°å…¥
